
{% block content %}
<div class="container mt-4">
    <h2>Delete Uploaded Files</h2>
    
    {% if files %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>File Name</th>
                        <th>Size</th>
                        <th>Upload Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for file in files %}
                    <tr id="row-{{ file.name|slugify }}">
                        <td>{{ file.name }}</td>
                        <td>{{ file.size|filesizeformat }}</td>
                        <td>{{ file.upload_time|date:"M d, Y H:i" }}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" 
                                    onclick="deleteFile('{{ file.name }}')">
                                Delete
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert alert-info">
            No files uploaded yet.
        </div>
    {% endif %}
</div>

<script>
function deleteFile(filename) {
    if (!confirm('Are you sure you want to delete ' + filename + '?')) {
        return;
    }
    
    // Create form data with CSRF token
    const formData = new FormData();
    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
    
    fetch(`/delete-file/${filename}`, {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': '{{ csrf_token }}'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Remove the row from table
            const row = document.getElementById(`row-${filename.replace(/\./g, '-')}`);
            if (row) {
                row.remove();
            }
            alert(data.message);
            
            // Reload if no files left
            if (document.querySelector('tbody').children.length === 0) {
                location.reload();
            }
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Network error occurred');
    });
}
</script>
{% endblock %}